#include "tk7island.h"
#include "wavetables.h"

uint16_t wavetable_len[NUM_WAVETABLES];

uint16_t* wavetables[NUM_WAVETABLES];

void init_wavetables() {
  for (int i = 0; i < NUM_WAVETABLES; ++i) {
    wavetables[i] = _wavetables[i];
    wavetable_len[i] = 128;
  }
}

float get_wave_value(const uint16_t w_index, const float phase) {
  const float p = phase - (uint16_t) phase;
  const uint16_t s_index = (uint16_t) ((float) wavetable_len[w_index] * p);
  const uint16_t e_index = (s_index + 1) % wavetable_len[w_index];
  const float r = wavetable_len[w_index] * p - s_index;
  const uint16_t s_val = wavetables[w_index][s_index];
  const uint16_t e_val = wavetables[w_index][e_index];
  return ((float) ((1.f - r) * s_val + r * e_val)  / (float) 0xFFFF * 2.f - 1.0);
}

uint16_t _wavetables[NUM_WAVETABLES][128] = {{
  // Izu-Ohshima
  0x0000, 0x0720, 0x0B14, 0x0DF1, 0x0F02, 0x1117, 0x14C0, 0x175C, 0x179B, 0x1A11, 0x1D03, 0x2117, 0x24B5, 0x258F, 0x2960, 0x2D00,
  0x2B4B, 0x32F0, 0x35A7, 0x388E, 0x3EFD, 0x3F5C, 0x4486, 0x455A, 0x4A42, 0x4960, 0x4F1E, 0x5822, 0x5797, 0x59E7, 0x61BC, 0x694F,
  0x6F72, 0x6EB9, 0x7AAC, 0x881A, 0x9071, 0x95F6, 0xA57B, 0xB0C1, 0xBBC9, 0xC23C, 0xB948, 0xB910, 0xB9E7, 0xBB25, 0xBCFE, 0xBF9F,
  0xC319, 0xC877, 0xD02B, 0xDA2C, 0xE451, 0xED8F, 0xF0D7, 0xEEDC, 0xF635, 0xFCFD, 0xFC6A, 0xF86E, 0xFB07, 0xF31F, 0xEC36, 0xE660,
  0xE0AA, 0xDB7E, 0xD8A0, 0xD6A8, 0xD54C, 0xD489, 0xD3D5, 0xD37A, 0xD35F, 0xD38E, 0xD3C4, 0xD4D1, 0xDB98, 0xD616, 0xCE8A, 0xC723,
  0xC124, 0xBB5F, 0xB6B0, 0xB2AB, 0xAEB9, 0xAC73, 0xACCB, 0xAA10, 0xA819, 0xA41D, 0xA22D, 0x9FA4, 0x9CF5, 0x99F5, 0x9821, 0x9819,
  0x950B, 0x91AE, 0x8D99, 0x89A8, 0x89B3, 0x8837, 0x843C, 0x87C2, 0x84AE, 0x831A, 0x84F4, 0x829E, 0x7F5D, 0x7B54, 0x7CA4, 0x7B97,
  0x789F, 0x77AF, 0x72D1, 0x6F4C, 0x6BAF, 0x69C3, 0x6820, 0x6ADD, 0x67C8, 0x6A23, 0x6890, 0x645E, 0x4EF1, 0x3148, 0x1323, 0x0000
  }, {
  // Toshima
  0x0000, 0x0111, 0x0266, 0x0D09, 0x156B, 0x1BFE, 0x248F, 0x2EFA, 0x387A, 0x402F, 0x4AB6, 0x59A1, 0x6474, 0x6D2C, 0x710F, 0x74C1,
  0x77C0, 0x7B49, 0x7DDD, 0x820F, 0x82B5, 0x86F8, 0x8A25, 0x8EB5, 0x8FDC, 0x92F8, 0x95F3, 0x98D5, 0x9BD1, 0x9E93, 0xA180, 0xA40B,
  0xA63F, 0xA88C, 0xAAC3, 0xACF2, 0xAF09, 0xB112, 0xB4AA, 0xB804, 0xBB42, 0xBE56, 0xC148, 0xC39C, 0xC62E, 0xC967, 0xCB8F, 0xCE05,
  0xD10A, 0xD4DE, 0xD8FE, 0xDCD0, 0xE0CD, 0xE440, 0xE7B4, 0xEB3B, 0xEF14, 0xF235, 0xF575, 0xF6E9, 0xF8A2, 0xFA02, 0xFBA7, 0xFD54,
  0xFECB, 0xFFA0, 0xFFDD, 0xFE19, 0xFA16, 0xF5A4, 0xF0B9, 0xEBFB, 0xE7BD, 0xE2FC, 0xDE84, 0xDA1A, 0xD55F, 0xD074, 0xCBD2, 0xC738,
  0xC20D, 0xBD39, 0xB7E9, 0xB2E1, 0xADDD, 0xA8FC, 0xA451, 0x9F53, 0x9AFA, 0x966A, 0x91B5, 0x8D38, 0x88FD, 0x84A9, 0x810F, 0x7E76,
  0x7C58, 0x79E2, 0x7714, 0x741A, 0x712C, 0x7022, 0x700B, 0x6FD6, 0x6ECC, 0x6D8A, 0x6BBD, 0x69D2, 0x68A8, 0x668B, 0x655B, 0x621D,
  0x5F73, 0x5D56, 0x5930, 0x5291, 0x4A59, 0x43BB, 0x3E67, 0x34FE, 0x2CF6, 0x2699, 0x2169, 0x1C94, 0x12F3, 0x0566, 0x01AC, 0x0000
  }, {
  // Nii-jima
  0x0000, 0x019F, 0x02D7, 0x0832, 0x0A13, 0x0A4D, 0x0A86, 0x0AEB, 0x0DBF, 0x1201, 0x1423, 0x15F7, 0x1952, 0x2018, 0x2897, 0x2F86,
  0x3598, 0x3B3E, 0x4101, 0x463B, 0x4A2F, 0x4C5E, 0x51AE, 0x50AA, 0x596B, 0x635C, 0x6F79, 0x776F, 0x7F61, 0x87EF, 0x9015, 0x946C,
  0xA3FB, 0xB4BD, 0xC247, 0xCCA0, 0xD7D2, 0xE0FE, 0xE76C, 0xED7F, 0xECE2, 0xF17D, 0xF8CF, 0xFA75, 0xF9BC, 0xFA8E, 0xFAE4, 0xFA14,
  0xF92A, 0xF916, 0xFACD, 0xFBDD, 0xFDED, 0xFFD9, 0xFDD8, 0xFBBD, 0xF8C9, 0xF64C, 0xF1C5, 0xF219, 0xF0C3, 0xED9C, 0xEABA, 0xE98F,
  0xEBFD, 0xEF72, 0xF217, 0xF5BA, 0xF616, 0xF385, 0xF188, 0xF236, 0xF159, 0xF2D9, 0xF339, 0xF56B, 0xF452, 0xF33D, 0xF187, 0xF262,
  0xEE9C, 0xEAFA, 0xE88B, 0xE202, 0xDBDA, 0xD5E8, 0xD086, 0xCA9A, 0xC784, 0xC6E0, 0xC420, 0xBFCC, 0xBB53, 0xB8CF, 0xB66C, 0xB2CC,
  0xAD63, 0xA73B, 0xA207, 0x9B53, 0x92D9, 0x8B68, 0x8517, 0x802B, 0x7DEC, 0x79F4, 0x7396, 0x6EFD, 0x65A4, 0x5BA6, 0x50CD, 0x44B6,
  0x38DE, 0x32FF, 0x2E5B, 0x29E2, 0x23F1, 0x242A, 0x203A, 0x1C8A, 0x1A81, 0x1802, 0x15D4, 0x1331, 0x11B4, 0x09AF, 0x043D, 0x0000
  }, {
  // Shikine-jima
  0x0000, 0x67C5, 0xA581, 0xD1B5, 0xF913, 0xFB83, 0xF500, 0xFE96, 0xF2F8, 0xDAE1, 0xD3B5, 0xABE0, 0x953D, 0x6EB3, 0x66E7, 0x50AC,
  0x70B2, 0x6A7C, 0x70FC, 0x8F37, 0x898B, 0x827D, 0x7BAB, 0x7857, 0x784E, 0x7C22, 0x6F01, 0x77C9, 0x7C73, 0x7CB5, 0x7B72, 0x83DF,
  0x6DBC, 0x68B4, 0x6402, 0x5E9F, 0x6674, 0x6CA6, 0x71AB, 0x7819, 0x7FBC, 0x8AAC, 0x99DE, 0xAF48, 0xB126, 0xA3DB, 0x8752, 0x7C1B,
  0x7470, 0x6D0D, 0x6D89, 0x7158, 0x6D30, 0x5DCE, 0x541E, 0x521A, 0x51A9, 0x547C, 0x5DA2, 0x6010, 0x60F1, 0x5EF2, 0x612F, 0x645F,
  0x6919, 0x68FB, 0x6DB5, 0x742D, 0x7985, 0x73E1, 0x730E, 0x7178, 0x70BF, 0x70D8, 0x743B, 0x7542, 0x7B06, 0x8BAD, 0x92DF, 0x9413,
  0x9381, 0x90B6, 0x8A2B, 0x7E40, 0x761A, 0x6B56, 0x60E1, 0x5EC8, 0x54AC, 0x5057, 0x4E18, 0x4D09, 0x4A5C, 0x492D, 0x48E9, 0x4B45,
  0x4D18, 0x534D, 0x53D6, 0x5490, 0x6561, 0x6400, 0x63BF, 0x60A4, 0x626D, 0x64A2, 0x6929, 0x6DC0, 0x6E46, 0x6E8F, 0x6F9C, 0x70AF,
  0x70A8, 0x709C, 0x72D3, 0x706A, 0x6CC6, 0x6F24, 0x6396, 0x575B, 0x2309, 0x0A9F, 0x01D5, 0x0822, 0x414F, 0x420D, 0x0BFC, 0x0000
  }, {
  // Koudu-shima
  0x0000, 0x02A9, 0x01A9, 0x0268, 0x02E8, 0x079C, 0x0621, 0x0844, 0x0D7B, 0x1A35, 0x1D47, 0x1620, 0x188A, 0x2031, 0x1C89, 0x1DF5,
  0x1F4B, 0x2550, 0x1CB5, 0x1D7C, 0x1F65, 0x2476, 0x2BD3, 0x3672, 0x412C, 0x4B5D, 0x50B5, 0x5783, 0x5F92, 0x681F, 0x6C44, 0x6BEC,
  0x63AA, 0x5A35, 0x47D1, 0x47D0, 0x53FB, 0x59C1, 0x577D, 0x586E, 0x58B0, 0x59C2, 0x605B, 0x83D6, 0x872F, 0x8BEF, 0x8CAB, 0x9185,
  0x90E9, 0x906F, 0x933E, 0x9551, 0x997C, 0x99AF, 0x9B53, 0x9ACE, 0x9C29, 0xA243, 0xAA0A, 0xB062, 0xB6E5, 0xBFC3, 0xC62C, 0xCE16,
  0xD5EA, 0xDDBA, 0xE569, 0xE47E, 0xE496, 0xECFA, 0xF3CC, 0xF3FC, 0xF140, 0xEDDE, 0xF403, 0xF994, 0xFC83, 0xFFFB, 0xF9FD, 0xF5D0,
  0xF592, 0xF75B, 0xF6F8, 0xFBEE, 0xFC1E, 0xF7E8, 0xF43B, 0xFA3D, 0xF008, 0xC5CE, 0xBB9B, 0xB1A2, 0xAA9C, 0xA109, 0x98D9, 0x8E50,
  0x8814, 0x8315, 0x80C0, 0x7F42, 0x816E, 0x88EE, 0x91BB, 0xA588, 0xAAA1, 0xA581, 0xA0F5, 0xA260, 0xA1EB, 0xA2D1, 0xA23F, 0xA2C2,
  0xA6EF, 0xA9F7, 0x9C55, 0x941C, 0x8D31, 0x79B3, 0x7568, 0x6B8B, 0x629B, 0x590E, 0x51D7, 0x4C71, 0x49F4, 0x42B8, 0x2492, 0x0000
  }, {
  // Miyake-jima
  0x0000, 0x0E72, 0x168C, 0x11BE, 0x1CC4, 0x1ED6, 0x2162, 0x253B, 0x2761, 0x2AC9, 0x2DF1, 0x3607, 0x3788, 0x3B0F, 0x392D, 0x37E1,
  0x3B7B, 0x450A, 0x3EB8, 0x4494, 0x4E7E, 0x5803, 0x6392, 0x607C, 0x6772, 0x6B4A, 0x7030, 0x7639, 0x7CEC, 0x7E1C, 0x7DF0, 0x7F75,
  0x813C, 0x848B, 0x8706, 0x8834, 0x8B88, 0x8C43, 0x91A3, 0x9974, 0x9A59, 0x9986, 0x989D, 0x9A80, 0x9E1E, 0xA162, 0xA9AC, 0xAEEC,
  0xB4BB, 0xBABB, 0xBE50, 0xC0BC, 0xC798, 0xCF38, 0xD887, 0xE11C, 0xE60B, 0xED66, 0xF032, 0xCB69, 0xB80A, 0x9D79, 0x7FFC, 0x6F36,
  0x6766, 0x653D, 0x6616, 0x6162, 0x6034, 0x5F01, 0x5EFB, 0x5F8D, 0x5FF6, 0x6049, 0x6176, 0x66BB, 0x6CAE, 0x7279, 0x77A1, 0x80FB,
  0x8906, 0x983A, 0xB2F3, 0xD22A, 0xE3D5, 0xFF78, 0xFB5C, 0xF0B4, 0xE659, 0xE0B6, 0xD9ED, 0xCED5, 0xC4D4, 0xBB72, 0xB2B1, 0xAA91,
  0x9F52, 0x9718, 0x9169, 0x8D22, 0x8386, 0x7C59, 0x77C1, 0x75B7, 0x6B2A, 0x65F1, 0x63AE, 0x6122, 0x5DF4, 0x5C4C, 0x5494, 0x428A,
  0x356E, 0x295F, 0x1DC0, 0x1885, 0x13CB, 0x11B3, 0x0E59, 0x0CD0, 0x0B94, 0x0B59, 0x1034, 0x040C, 0x0280, 0x0261, 0x023D, 0x0000
  }, {
  // Mikura-jima
  0x0000, 0x085F, 0x174F, 0x3241, 0x38B2, 0x3CE2, 0x400A, 0x44B8, 0x4BCE, 0x4CFF, 0x521C, 0x5405, 0x568B, 0x5932, 0x5D02, 0x62EF,
  0x6677, 0x6947, 0x6ED1, 0x7210, 0x7314, 0x779A, 0x7BDF, 0x7FE4, 0x8386, 0x8720, 0x8B49, 0x8A56, 0x8E52, 0x8FA7, 0x935A, 0x987E,
  0x9FF8, 0xA340, 0xA65B, 0xABC7, 0xAFEB, 0xB20E, 0xB3AD, 0xB885, 0xBD0D, 0xC1E9, 0xC5E8, 0xC8AC, 0xCC8C, 0xCFC4, 0xD292, 0xD735,
  0xDB46, 0xDEAB, 0xE3F0, 0xE71C, 0xEA3E, 0xEE88, 0xF2E2, 0xF5A7, 0xF559, 0xF775, 0xF93A, 0xFB30, 0xFC51, 0xFE8A, 0xFDCA, 0xFF3F,
  0xFDF9, 0xF69F, 0xF0CD, 0xEAB3, 0xE077, 0xD7CE, 0xD02C, 0xC9EC, 0xC60D, 0xBDDB, 0xB6C0, 0xAE08, 0xA5EC, 0xA21D, 0xA7DD, 0xA27C,
  0xA7B2, 0xA727, 0xA4A3, 0xA95A, 0xAC7E, 0xA907, 0xA94E, 0xAF6D, 0xB2B5, 0xBAD3, 0xC4AC, 0xCB80, 0xCC45, 0xC915, 0xC552, 0xC3E6,
  0xC31F, 0xBEC5, 0xBA22, 0xB729, 0xB3D8, 0xB206, 0xAE84, 0xA344, 0x9150, 0x89A0, 0x838A, 0x77DD, 0x7215, 0x6C94, 0x66F9, 0x5C12,
  0x5208, 0x474D, 0x3C2B, 0x332C, 0x2B20, 0x1F93, 0x1E7C, 0x1F7B, 0x1F21, 0x22BB, 0x23F9, 0x2010, 0x21FC, 0x15C6, 0x0512, 0x0000
  }, {
  // Hachijo-jima
  0x0000, 0x042E, 0x07EF, 0x0B20, 0x10D6, 0x149F, 0x170A, 0x1A06, 0x1CFF, 0x2043, 0x2354, 0x26A0, 0x2939, 0x2C9B, 0x3177, 0x35E8,
  0x3B2A, 0x4132, 0x4705, 0x4CCE, 0x5166, 0x584C, 0x5E95, 0x664A, 0x6AFA, 0x7183, 0x7762, 0x7D99, 0x855D, 0x8AFC, 0x9026, 0x96FD,
  0x9B9E, 0x9F1C, 0xA2E0, 0xA56B, 0xA848, 0xAC36, 0xB021, 0xB35D, 0xB6FD, 0xBB96, 0xC158, 0xC796, 0xCC1A, 0xD016, 0xD475, 0xDA21,
  0xE103, 0xE91D, 0xF1B6, 0xF96F, 0xFEDD, 0xF4FF, 0xED0C, 0xF208, 0xF233, 0xF2AD, 0xF2A4, 0xF31A, 0xF0E8, 0xEFE4, 0xEBDF, 0xF61A,
  0xFA0A, 0xF218, 0xE96D, 0xE0D2, 0xD901, 0xD24E, 0xCBE3, 0xC5DE, 0xBFF4, 0xB9CD, 0xB436, 0xAFA9, 0xA9F9, 0xA6BB, 0xA2E3, 0x9CA7,
  0x95DA, 0x90A5, 0x8C6A, 0x868C, 0x7E48, 0x7621, 0x70E3, 0x6B66, 0x6668, 0x5F4D, 0x5A9F, 0x548B, 0x50EA, 0x4F4B, 0x4CB8, 0x48A9,
  0x444C, 0x4243, 0x4032, 0x3B20, 0x361B, 0x3025, 0x2C96, 0x2998, 0x2730, 0x244D, 0x2481, 0x2474, 0x2424, 0x2344, 0x21D9, 0x20F2,
  0x1CE5, 0x1B30, 0x19DE, 0x1861, 0x16B6, 0x1405, 0x1208, 0x100E, 0x0E48, 0x0C1C, 0x0BD4, 0x0A7A, 0x0923, 0x06F2, 0x0524, 0x0000
  }, {
  // Aogashima
  0x0000, 0x017D, 0x0424, 0x0E70, 0x26CE, 0x2D91, 0x36C2, 0x4127, 0x559E, 0x5CFC, 0x635D, 0x7061, 0x7EB6, 0x86C5, 0x8FD4, 0x9893,
  0xA2FD, 0xADA0, 0xBB4D, 0xC90F, 0xD415, 0xD88A, 0xD930, 0xDD3E, 0xE7AC, 0xEC3C, 0xED1F, 0xECD8, 0xE885, 0xE321, 0xDF40, 0xE3D6,
  0xE4A0, 0xE351, 0xE4B3, 0xE6E6, 0xE8D4, 0xEB5F, 0xEF39, 0xF33D, 0xF349, 0xF840, 0xFEC1, 0xFF44, 0xFEEC, 0xFCB0, 0xF90A, 0xF30B,
  0xF0C4, 0xEE35, 0xEB5A, 0xE1AC, 0xD266, 0xC8FB, 0xC36C, 0xAEAE, 0x9886, 0x9A67, 0xA6D3, 0xAD64, 0xA52C, 0x9A2B, 0x9306, 0x8FA0,
  0x8565, 0x7CAB, 0x73C2, 0x6DE1, 0x74D0, 0x74DE, 0x7523, 0x69AB, 0x6B09, 0x6896, 0x6713, 0x7490, 0x77FA, 0x76F6, 0x78BC, 0x815A,
  0x87C7, 0x8B2E, 0x825A, 0x8BE8, 0x9675, 0xA09C, 0xA766, 0xAEFB, 0xBAA2, 0xBF4D, 0xBE7E, 0xAAE2, 0xA4D3, 0xAA25, 0xAD3D, 0xB18C,
  0xB7E3, 0xB7ED, 0xB619, 0xAC01, 0xABA2, 0xAAC5, 0xA562, 0x9E56, 0x99FC, 0x96B5, 0x8F50, 0x86BD, 0x7E67, 0x7651, 0x6ED4, 0x694C,
  0x64C4, 0x63C3, 0x6132, 0x5E0E, 0x5CCA, 0x5911, 0x5419, 0x46E0, 0x407A, 0x2F94, 0x2318, 0x197F, 0x1139, 0x0935, 0x0276, 0x0000
  }
};

